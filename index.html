<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Biblioteca | Paginada</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        :root { --primary: #4f46e5; --bg: #f1f5f9; --card: #ffffff; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        .container { max-width: 1100px; margin: 0 auto; }
        
        /* Buscador */
        .search-container { 
            display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); 
            gap: 12px; background: white; padding: 20px; border-radius: 16px; 
            margin-bottom: 20px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        }
        input { padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px; }

        /* Grid y Tarjetas */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .card { 
            background: var(--card); padding: 20px; border-radius: 12px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.05); border-top: 4px solid var(--primary);
        }

        /* PAGINACIÓN */
        .pagination {
            display: flex; justify-content: center; align-items: center;
            gap: 15px; margin: 30px 0;
        }
        .btn-pag {
            padding: 10px 20px; background: var(--primary); color: white;
            border: none; border-radius: 8px; cursor: pointer; font-weight: bold;
        }
        .btn-pag:disabled { background: #cbd5e1; cursor: not-allowed; }
        #pageInfo { font-weight: bold; color: #475569; }

        .loading { text-align: center; grid-column: 1/-1; padding: 40px; }
    </style>
</head>
<body>

<div class="container">
    <h1 style="text-align:center; color: var(--primary);">Mi Biblioteca</h1>
    
    <div class="search-container">
        <input type="text" id="fNombre" placeholder="Nombre..." onkeyup="resetYFiltrar()">
        <input type="text" id="fPlataforma" placeholder="Plataforma..." onkeyup="resetYFiltrar()">
        <input type="number" id="fAño" placeholder="Año..." onkeyup="resetYFiltrar()">
        <input type="number" id="fPuntos" placeholder="Nota..." onkeyup="resetYFiltrar()">
    </div>

    <div id="grid" class="grid">
        <div class="loading">Conectando con Google Sheets...</div>
    </div>

    <div class="pagination">
        <button id="btnPrev" class="btn-pag" onclick="changePage(-1)">Anterior</button>
        <span id="pageInfo">Página 1</span>
        <button id="btnNext" class="btn-pag" onclick="changePage(1)">Siguiente</button>
    </div>
</div>

<script>
    const urlSheet = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTqp9_7gRe9hMmEXJDq71YKVUUIEWlkq7jWX9JfZhUF_Ztw6NFtouJdJqeYUZne027X1U3sArOCzQvn/pub?output=csv';
    
    let datosCompletos = [];
    let datosFiltrados = [];
    let paginaActual = 1;
    const itemsPorPagina = 12; // <--- Cambia este número si quieres más o menos tarjetas por página

    async function cargarDatos() {
        Papa.parse(urlSheet, {
            download: true, header: true, skipEmptyLines: true,
            complete: function(results) {
                datosCompletos = results.data;
                datosFiltrados = [...datosCompletos];
                renderizar();
            }
        });
    }

    function renderizar() {
        const grid = document.getElementById('grid');
        grid.innerHTML = '';

        // Cálculo de índices para la página actual
        const inicio = (paginaActual - 1) * itemsPorPagina;
        const fin = inicio + itemsPorPagina;
        const itemsPagina = datosFiltrados.slice(inicio, fin);

        if(itemsPagina.length === 0) {
            grid.innerHTML = '<div class="loading">No hay resultados que mostrar.</div>';
        }

        itemsPagina.forEach(item => {
            grid.innerHTML += `
                <div class="card">
                    <h3>${item.Nombre || '---'}</h3>
                    <p><strong>${item.Plataforma || '---'}</strong> (${item.Año || '---'})</p>
                    <p style="color: #059669; font-weight:bold;">⭐ ${item.Puntuación || '0'}/10</p>
                    <p style="font-size:0.9em; color:#64748b;"><em>${item.Comentario || ''}</em></p>
                </div>
            `;
        });

        actualizarControles();
    }

    function resetYFiltrar() {
        paginaActual = 1; // Siempre volver a la página 1 al buscar
        filtrar();
    }

    function filtrar() {
        const n = document.getElementById('fNombre').value.toLowerCase();
        const p = document.getElementById('fPlataforma').value.toLowerCase();
        const a = document.getElementById('fAño').value;
        const pts = document.getElementById('fPuntos').value;

        datosFiltrados = datosCompletos.filter(i => {
            return (i.Nombre?.toLowerCase().includes(n)) &&
                   (i.Plataforma?.toLowerCase().includes(p)) &&
                   (a === "" || i.Año == a) &&
                   (pts === "" || i.Puntuación?.includes(pts));
        });
        renderizar();
    }

    function changePage(direccion) {
        paginaActual += direccion;
        renderizar();
        window.scrollTo(0, 0); // Sube al principio al cambiar de página
    }

    function actualizarControles() {
        const totalPaginas = Math.ceil(datosFiltrados.length / itemsPorPagina);
        document.getElementById('pageInfo').innerText = `Página ${paginaActual} de ${totalPaginas || 1}`;
        document.getElementById('btnPrev').disabled = (paginaActual === 1);
        document.getElementById('btnNext').disabled = (paginaActual >= totalPaginas);
    }

    cargarDatos();
</script>
</body>
</html>
